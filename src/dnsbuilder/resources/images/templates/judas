# Dockerfile for {name} (JudasDNS v{version})
# Auto-generated by DNS Builder

FROM {base_image}

ENV DEBIAN_FRONTEND=noninteractive

# Install chsrc if mirror config uses 'auto'
{chsrc_install_setup}

# NOTE: Debian Buster reached EOL in Aug 2022. Switch to archive before mirror setup
RUN sed -i 's/deb.debian.org/archive.debian.org/g' /etc/apt/sources.list && \
    sed -i 's/security.debian.org/archive.debian.org/g' /etc/apt/sources.list && \
    sed -i '/buster-updates/d' /etc/apt/sources.list

# Mirror setup (disabled for Buster - archives not on most mirrors)
# {apt_mirror_setup}
{pip_mirror_setup}

# Install dependencies
{dep_packages}

# Clone the JudasDNS repository from GitHub
RUN git clone https://github.com/mandatoryprogrammer/JudasDNS.git /usr/src/judasdns

# Set the working directory
WORKDIR /usr/src/judasdns

# Install app dependencies
{npm_registry_setup}
RUN npm install

# Install utils
{util_packages}

# Expose the default DNS port
EXPOSE 53/udp
EXPOSE 2248/udp

# Define the command to run the app
# CMD [ "node", "judasdns.js" ]